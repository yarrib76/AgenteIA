<div class="card module-card">
  <div class="card-header">
    <h2>Conversaciones</h2>
  </div>

  <div class="chat-toolbar">
    <label class="field">
      <span>Contacto</span>
      <select id="contactSelect">
        <option value="">Seleccionar...</option>
        <% contacts.forEach(function(contact) { %>
        <option value="<%= contact.id %>" <%= selectedContactId === contact.id ? "selected" : "" %>>
          <%= contact.name %> [<%= contact.type === "group" ? "Grupo" : "Usuario" %>] (<%= contact.type === "group" ? (contact.groupId || contact.whatsappId || "-") : contact.phone %>)
        </option>
        <% }) %>
      </select>
    </label>
    <button id="clearHistoryBtn" class="secondary-button danger-button" type="button">
      Borrar historial
    </button>
  </div>

  <div id="chatStatus" class="note">
    <% if (whatsappReady) { %> WhatsApp vinculado. <% } else { %> WhatsApp no vinculado. <% } %>
  </div>

  <div id="chatWindow" class="chat-window">
    <% if (!messages || messages.length === 0) { %>
    <p class="note">Sin mensajes recientes para este contacto.</p>
    <% } else { %>
    <% messages.forEach(function(msg) { %>
    <div class="message <%= msg.direction === 'out' ? 'out' : 'in' %>">
      <div class="bubble"><%= msg.text %></div>
      <span class="meta"><%= msg.timestampFormatted || msg.timestamp %></span>
    </div>
    <% }) %>
    <% } %>
  </div>

  <form id="chatForm" class="chat-form">
    <input type="text" id="chatInput" maxlength="2000" placeholder="Escribe un mensaje..." required />
    <button class="primary-button" type="submit">Enviar</button>
  </form>
</div>
