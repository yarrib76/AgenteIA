<div class="card module-card">
  <div class="card-header">
    <h2>Registrar contacto</h2>
  </div>

  <form id="agendaForm" class="form-grid">
    <input type="hidden" id="contactId" name="contactId" />
    <label class="field">
      <span>Tipo</span>
      <select id="contactType" name="type" required>
        <option value="contact">Usuario</option>
        <option value="group">Grupo</option>
      </select>
    </label>
    <label class="field">
      <span>Nombre</span>
      <input type="text" name="name" required maxlength="80" />
    </label>
    <label id="contactPhoneField" class="field">
      <span>Numero WhatsApp</span>
      <input type="text" name="phone" required maxlength="20" placeholder="54911..." />
    </label>
    <label id="contactGroupField" class="field hidden">
      <span>Grupo WhatsApp</span>
      <div class="inline-actions">
        <select id="contactGroupId" name="groupId">
          <option value="">Seleccionar grupo...</option>
        </select>
        <button id="refreshGroupsBtn" class="secondary-button" type="button">Actualizar</button>
      </div>
      <small class="note">Se listan los grupos visibles para el telefono vinculado.</small>
    </label>
    <div class="inline-actions">
      <button id="saveContactBtn" class="primary-button" type="submit">Guardar contacto</button>
      <button id="cancelEditContactBtn" class="secondary-button hidden" type="button">
        Cancelar edicion
      </button>
    </div>
  </form>

  <p id="agendaMsg" class="note"></p>
</div>

<div class="card module-card mt-16">
  <div class="card-header">
    <h2>Contactos guardados</h2>
  </div>
  <div id="contactsList">
    <% if (!contacts || contacts.length === 0) { %>
    <p class="note">No hay contactos cargados.</p>
    <% } else { %>
    <table class="table">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Tipo</th>
          <th>WhatsApp</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <% contacts.forEach(function(contact) { %>
        <tr>
          <td><%= contact.name %></td>
          <td><%= contact.type === "group" ? "Grupo" : "Usuario" %></td>
          <td><%= contact.type === "group" ? (contact.groupId || contact.whatsappId || "-") : contact.phone %></td>
          <td>
            <div class="inline-actions">
              <button
                class="secondary-button edit-contact-btn"
                type="button"
                data-id="<%= contact.id %>"
                data-name="<%= contact.name %>"
                data-type="<%= contact.type || 'contact' %>"
                data-phone="<%= contact.phone %>"
                data-group-id="<%= contact.groupId || contact.whatsappId || '' %>"
              >
                Editar
              </button>
              <button
                class="secondary-button danger-button delete-contact-btn"
                type="button"
                data-id="<%= contact.id %>"
                data-name="<%= contact.name %>"
              >
                Eliminar
              </button>
            </div>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
    <% } %>
  </div>
</div>
